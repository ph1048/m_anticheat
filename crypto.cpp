#include "main.h"
#include "crypto.h"

__declspec(align(1)) struct BitField
{
	unsigned b1:1;
	unsigned b2:1;
	unsigned b3:1;
	unsigned b4:1;
	unsigned b5:1;
	unsigned b6:1;
	unsigned b7:1;
	unsigned b8:1;
};

#ifdef SERVER_TWINKLE
unsigned char bSwapTable[]		= "\x39\x7B\xF8\x62\x21\x5E\xD3\xDE\xF5\x13\xEA\x8E\xFD\xAF\x5B\x51\x48\xDA\x88\xAD\xEF\x5D\xED\xA7\x42\x56\x36\x14\xF7\xB1\xC3\xB2\xE1\xCE\x9D\x28\x3D\x45\x94\x07\x60\x2C\xFC\x25\x8C\xC2\x96\x64\xD6\xBC\xBE\x3A\x3F\x0D\x7E\xD5\x41\x90\xEC\x47\xE8\xC0\x61\x6B\x83\xC1\x17\xA8\x55\x22\x2B\x1B\xA3\x2F\xD8\xFB\xB0\x11\x10\x9C\x4E\x46\x71\x0C\xCB\x77\x70\x73\xF3\x80\xC9\x9A\x58\x87\x09\x7A\xF1\xD7\x03\x54\x7D\x33\xC4\x6E\xE2\x5C\x89\xD0\x0F\xA4\x31\x72\x27\xDF\xFE\xF0\x3C\xC6\x3E\xA1\x69\x06\xE3\x6A\x34\xF9\x38\x30\xE4\x20\xAA\xAB\xE5\x9B\xB3\xCD\x7C\x9E\x4A\xCC\x2E\xF4\x4F\x2D\x1D\xA6\x8D\xC5\xF6\x6C\xE9\xB6\x78\x8A\x85\x91\x50\x52\x37\x35\xEB\xC8\xAC\xA0\xB8\xBD\x40\x93\xD9\xBA\x84\xA9\xD1\x12\x43\x0A\x26\x00\x08\x66\xA2\x32\x01\xB7\x81\x97\xBB\xB5\xB4\x23\x1C\xBF\x4D\xCA\x86\x8B\xDB\x5F\x57\x63\xD4\x04\x1A\x24\x1E\x99\x82\x92\xDD\x68\xE0\xAE\x6F\x05\xCF\xF2\x9F\x0E\x5A\x67\x18\x53\xFF\x02\xC7\xE7\x98\xDC\x8F\x2A\xB9\x65\x6D\x16\x1F\xE6\xD2\x74\x49\x76\x4C\x4B\x0B\x19\x59\x79\x44\x3B\xFA\x29\x75\xA5\x15\xEE\x95\x7F";
unsigned char bUnSwapTable[]	= "\xB1\xB6\xDF\x62\xC9\xD5\x79\x27\xB2\x5E\xAF\xF2\x53\x35\xD9\x6C\x4E\x4D\xAD\x09\x1B\xFC\xE9\x42\xDC\xF3\xCA\x47\xBE\x90\xCC\xEA\x81\x04\x45\xBD\xCB\x2B\xB0\x70\x23\xF9\xE5\x46\x29\x8F\x8C\x49\x7F\x6E\xB5\x65\x7C\x9F\x1A\x9E\x7E\x00\x33\xF7\x74\x24\x76\x34\xA6\x38\x18\xAE\xF6\x25\x51\x3B\x10\xEE\x8A\xF1\xF0\xC0\x50\x8E\x9C\x0F\x9D\xDD\x63\x44\x19\xC6\x5C\xF4\xDA\x0E\x69\x15\x05\xC5\x28\x3E\x03\xC7\x2F\xE7\xB3\xDB\xD1\x78\x7B\x3F\x95\xE8\x67\xD4\x56\x52\x6F\x57\xED\xFA\xEF\x55\x98\xF5\x5F\x01\x88\x64\x36\xFF\x59\xB8\xCE\x40\xAA\x9A\xC2\x5D\x12\x6A\x99\xC3\x2C\x92\x0B\xE4\x39\x9B\xCF\xA7\x26\xFE\x2E\xB9\xE2\xCD\x5B\x85\x4F\x22\x89\xD8\xA3\x77\xB4\x48\x6D\xFB\x91\x17\x43\xAB\x82\x83\xA2\x13\xD3\x0D\x4C\x1D\x1F\x86\xBC\xBB\x97\xB7\xA4\xE6\xA9\xBA\x31\xA5\x32\xBF\x3D\x41\x2D\x1E\x66\x93\x75\xE0\xA1\x5A\xC1\x54\x8B\x87\x21\xD6\x6B\xAC\xEC\x06\xC8\x37\x30\x61\x4A\xA8\x11\xC4\xE3\xD0\x07\x71\xD2\x20\x68\x7A\x80\x84\xEB\xE1\x3C\x96\x0A\xA0\x3A\x16\xFD\x14\x73\x60\xD7\x58\x8D\x08\x94\x1C\x02\x7D\xF8\x4B\x2A\x0C\x72\xDE";
unsigned char bSwapTable2[]		= "\x9F\xE1\x5B\x9C\x55\xAF\xA3\x8D\xC0\xD2\xBA\xCF\x5A\xB8\xD4\x0E\xA6\x07\xB3\xC6\x6A\x78\xDB\x9B\xB5\xDF\x31\x08\x16\x37\xCA\xAB\xF7\x13\x12\xA7\x91\x04\x7B\x4A\x86\x82\xEA\xEB\xE3\xF9\x29\xE0\xB6\x8C\x95\xCD\x90\x1C\xFD\x7D\xFB\x98\x30\x73\x35\x48\xE6\x23\x77\x69\x2B\xA2\xD3\x4E\x8F\x4B\x00\x52\x1B\x81\x56\x3B\x0D\x8A\xE8\x5C\x49\xE7\x21\x3F\x01\xC1\xF5\x6F\x2D\x2F\x6E\xD1\x44\xF6\xFF\x46\x67\x54\xDA\xBE\x80\x47\x88\x74\x94\xCB\xB4\x60\x40\xFA\xAC\x5E\xD0\x20\x68\x4F\x33\xCE\x18\xEF\x87\xC2\x27\xFC\x06\xA5\xE2\x19\xD6\x64\x7A\xA1\x1A\xBB\x3E\xC4\x63\x2A\x3C\xAD\xBC\xEC\x85\x39\x76\x7C\xB2\xF3\x24\x71\x97\xA0\xF2\x93\x62\x66\x3D\xC3\xF8\x7E\x36\x41\x38\xDE\xD5\x51\x99\x50\x1F\x34\x11\x0A\x43\xD8\xC7\x32\xB7\x10\x22\xE9\x53\x72\xC5\xA9\x0C\xEE\xED\x6C\x9A\x8B\x61\xF1\x45\x70\xF4\x42\xDD\xAA\x05\x5F\xB1\x6D\xB9\x0F\xBF\x15\xBD\x0B\x1E\x65\xF0\xD7\x17\xD9\x2E\x5D\xCC\xC8\x9E\xC9\x84\x92\x4D\xE4\x75\xA8\x25\x9D\x03\xE5\x7F\x14\x8E\x02\x57\x3A\x6B\x28\xDC\x79\x96\xA4\x2C\x59\x58\x1D\x09\x89\x4C\xB0\x83\xAE\xFE\x26";
unsigned char bUnSwapTable2[]	= "\x48\x56\xEB\xE6\x25\xC8\x7E\x11\x1B\xF8\xAD\xD1\xBA\x4E\x0F\xCD\xB3\xAC\x22\x21\xE9\xCF\x1C\xD6\x78\x81\x86\x4A\x35\xF7\xD2\xAA\x73\x54\xB4\x3F\x96\xE4\xFF\x7C\xEF\x2E\x8B\x42\xF4\x5A\xD8\x5B\x3A\x1A\xB1\x76\xAB\x3C\xA2\x1D\xA4\x91\xED\x4D\x8C\x9E\x88\x55\x6E\xA3\xC5\xAE\x5E\xC2\x61\x67\x3D\x52\x27\x47\xFA\xE0\x45\x75\xA9\xA7\x49\xB6\x63\x04\x4C\xEC\xF6\xF5\x0C\x02\x51\xD9\x71\xC9\x6D\xC0\x9C\x8A\x83\xD3\x9D\x62\x74\x41\x14\xEE\xBD\xCB\x5C\x59\xC3\x97\xB7\x3B\x69\xE2\x92\x40\x15\xF1\x84\x26\x93\x37\xA1\xE8\x66\x4B\x29\xFC\xDE\x90\x28\x7A\x68\xF9\x4F\xBF\x31\x07\xEA\x46\x34\x24\xDF\x9B\x6A\x32\xF2\x98\x39\xA8\xBE\x17\x03\xE5\xDC\x00\x99\x85\x43\x06\xF3\x7F\x10\x23\xE3\xB9\xC7\x1F\x70\x8D\xFD\x05\xFB\xCA\x94\x12\x6C\x18\x30\xB2\x0D\xCC\x0A\x87\x8E\xD0\x65\xCE\x08\x57\x7B\x9F\x89\xB8\x13\xB0\xDB\xDD\x1E\x6B\xDA\x33\x77\x0B\x72\x5D\x09\x44\x0E\xA6\x82\xD5\xAF\xD7\x64\x16\xF0\xC6\xA5\x19\x2F\x01\x80\x2C\xE1\xE7\x3E\x53\x50\xB5\x2A\x2B\x8F\xBC\xBB\x79\xD4\xC1\x9A\x95\xC4\x58\x5F\x20\xA0\x2D\x6F\x38\x7D\x36\xFE\x60";
unsigned char bEncryptionKey[]	= "\x8C\x90\x1A\x6B\xB2\x4E\x9C\xCE\x26\x17\x07\xE6\x8F\x9A\x16\x9E\xB5\xDD\xCD\xD7\x9D\x40\x33\xBA\x4D\xDE\xE5\x1C\x09\x03\xAB\x8E\x80\x23\xF7\x80\xBB\xD2\xA1\xBA\x12\x87\x5F\x1D\xA4\xB0\xBD\xBA\x2E\x53\xDF\xCC\xC4\x04\xC8\xAC\xC4\x92\x4F\x4B\x48\x12\x9B\xCC\x8C\x38\x61\x13\x75\x0B\x81\xA9\xAD\x9B\x6A\xA4\xA7\x2A\x1A\xB6\xF2\xC8\x3E\x98\x39\x81\x0D\xA5\xFC\xD8\xD0\x73\xFE\x51\x47\x8E\xAB\xA0\xF9\x7E\xE0\xFD\x80\x9D\xCC\x53\x6D\x5B\x3E\x0B\x39\x82\x10\x67\xE8\x7E\x3B\x24\x32\x63\xDA\xC0\x44\xB7\xAF\x89\xEE\xDC\xA5\x28\x07\x94\x67\x1F\x77\x87\x93\xA7\xC6\x95\x4D\x45\xCD\x2B\x8C\x72\x0C\xB1\xE2\xA6\xB3\x77\x29\xD6\x0A\x04\xC1\x4B\x49\x00\xDB\x3D\x17\x3F\xFB\xFD\x66\xFE\x55\xB7\xCE\x3C\x52\x84\xC1\x8C\x9A\x97\xCD\xBC\xE3\x21\x74\x1E\x13\x60\xE1\x37\x87\xD1\x39\xCB\x61\x0E\x85\xCB\xF1\x5F\x98\xCA\x6B\x8B\x48\x66\xFF\xFA\x46\x3F\x99\x21\x3A\x50\x15\xDA\xFA\xC3\x38\xC6\x71\x31\xB7\x90\x81\x9F\xF9\x2F\xF6\x5D\xFB\xD2\x3B\x22\xEC\xAB\x14\x60\x61\xA5\xF8\x0F\x6D\xCF\x93\xE7\x66\x3B\xF2\xC8\x09\x42\x5E\xF4\x4D\x42\x77\x98";
#endif

#ifdef SERVER_9EPISODE
unsigned char bSwapTable[]		= "\xD2\x6E\x66\x43\x39\x21\x8F\xA2\x38\x4D\x4F\x56\x3C\x7D\xE8\xA0\xEB\x63\x8E\x50\x89\x9C\x95\x77\x40\x16\xDB\x24\x48\xE5\x1E\x0A\x2D\x42\x93\x36\xFA\x67\x4C\xD4\x49\xEC\x57\x0E\xB5\x34\x9A\xD1\x9F\xF3\x01\xDD\x12\x69\xA5\x33\xC8\x32\x3B\x99\xAD\xCE\x72\x97\x70\xFE\x8B\x76\xF7\xBC\xAE\xCD\x41\x4B\xEA\x85\x1A\x73\x19\xA4\xBE\x9B\x3F\x80\x3D\x7E\x03\x27\x5E\x6D\x7C\xD8\x59\x26\xAF\xF5\xA6\x55\xDF\x45\x5C\xE1\xCA\xC1\xF9\xB6\x64\x75\x62\xE3\x02\x5D\x8A\x15\x07\x8C\x04\x06\xAB\xC5\xB9\x3A\x3E\x2F\xF6\xF2\xD0\xB7\x2C\xD9\x86\x74\xBF\x0C\x8D\x1D\x14\x52\x83\x61\xF0\xED\x28\x5B\x78\x17\x1C\x92\x5F\xA8\x2A\x82\xEE\x10\x60\xE9\xC4\x30\xE2\x5A\x91\xB3\xC2\xDC\x71\x31\x13\x2E\xA7\xCB\x54\x98\xFC\xB4\xFF\xFD\x6B\x51\xA9\xEF\xA1\xC0\x9D\x87\x6A\x22\x25\x4A\xD7\x88\xB0\x23\x18\x58\x2B\xE6\x44\x1F\x6C\xA3\x81\x08\xDE\x20\x79\xC6\x1B\x65\xD5\x46\x09\xE7\xB1\x94\xCF\xE4\x6F\x0F\x7F\x0D\xD6\xF1\xD3\xCC\x00\x7B\xC3\xF4\xAC\x84\xFB\x0B\x47\xE0\xBB\x37\x90\x05\x29\x4E\xC9\x53\xC7\x9E\x11\x96\x68\xBA\xBD\xB8\xDA\xB2\x35\x7A\xAA\xF8";
unsigned char bUnSwapTable[]	= "\xE0\x32\x6E\x56\x74\xED\x75\x72\xC9\xD2\x1F\xE7\x85\xDB\x2B\xD9\x99\xF4\x34\xA6\x88\x71\x19\x91\xC0\x4E\x4C\xCE\x92\x87\x1E\xC5\xCB\x05\xB9\xBF\x1B\xBA\x5D\x57\x8E\xEE\x96\xC2\x80\x20\xA7\x7B\x9D\xA5\x39\x37\x2D\xFC\x23\xEB\x08\x04\x79\x3A\x0C\x54\x7A\x52\x18\x48\x21\x03\xC4\x63\xD1\xE8\x1C\x28\xBB\x49\x26\x09\xEF\x0A\x13\xB1\x89\xF1\xAA\x61\x0B\x2A\xC1\x5C\x9F\x8F\x64\x6F\x58\x94\x9A\x8B\x6C\x11\x6A\xCF\x02\x25\xF6\x35\xB8\xB0\xC6\x59\x01\xD8\x40\xA4\x3E\x4D\x83\x6B\x43\x17\x90\xCC\xFD\xE1\x5A\x0D\x55\xDA\x53\xC8\x97\x8A\xE5\x4B\x82\xB7\xBD\x14\x70\x42\x73\x86\x12\x06\xEC\xA0\x93\x22\xD5\x16\xF5\x3F\xAB\x3B\x2E\x51\x15\xB6\xF3\x30\x0F\xB4\x07\xC7\x4F\x36\x60\xA8\x95\xB2\xFE\x76\xE4\x3C\x46\x5E\xBE\xD4\xFB\xA1\xAD\x2C\x69\x7F\xF9\x78\xF7\xEA\x45\xF8\x50\x84\xB5\x67\xA2\xE2\x9C\x77\xCD\xF2\x38\xF0\x66\xA9\xDF\x47\x3D\xD6\x7E\x2F\x00\xDE\x27\xD0\xDC\xBC\x5B\x81\xFA\x1A\xA3\x33\xCA\x62\xE9\x65\x9E\x6D\xD7\x1D\xC3\xD3\x0E\x9B\x4A\x10\x29\x8D\x98\xB3\x8C\xDD\x7D\x31\xE3\x5F\x7C\x44\xFF\x68\x24\xE6\xAC\xAF\x41\xAE";
unsigned char bEncryptionKey[]	= "\xE5\x8D\xB6\xC9\x62\x00\xE8\xDF\x51\xE3\xA4\x68\xDE\x43\x6A\xE0\x22\x4C\xF7\xBA\xE7\xD2\x15\x5B\xD0\xF5\xEB\xD5\x78\x0B\x0A\xC7\x07\x7C\x75\x6F\x49\x59\x25\x54\x32\xA9\xC0\x8E\xC6\x9F\x3C\x2D\x4D\xA8\xD6\x27\xCE\x37\xF1\xC4\x85\x35\x83\xBD\x60\x91\x29\xBF\xAC\x84\x3D\x90\x6C\xA3\x1E\xCC\xCA\x21\xB8\xCF\xC8\xDA\xDD\x03\x3F\xAF\x99\x96\xED\x7E\xB1\x7A\xAA\x8B\x1C\x38\x12\xD7\xB0\x23\xEA\xFB\x64\x14\x1B\x0F\x8A\xA1\xD4\xFE\x77\xCD\x8F\xEC\xA5\x4F\x89\x26\x3B\x61\x76\x2F\x7F\x81\xE2\xF6\xA6\x95\x5A\xE4\x70\x6E\x0C\x53\xFA\x42\x08\x57\x34\x58\x4A\x2E\x9A\x28\xF9\x4E\xC2\xB7\xA7\xCB\x36\x98\x6D\x45\x30\x82\x93\xF8\xFF\xE9\xBC\x71\x74\x69\x50\x13\x2B\x63\x6B\xC3\x79\x1A\x5C\x44\x8C\x55\xF3\x0D\x92\x17\x18\x52\xF4\x7D\xB2\x97\xB3\x20\xE6\x2C\x47\x11\x87\x94\xB5\x33\xBE\x7B\xD8\xEE\xA2\x9D\x3A\x9B\x9E\xF0\x31\xB9\x41\xC1\x88\xD1\xFC\x5D\x56\xEF\x80\xDC\x39\x24\x65\x1F\xAE\x86\xB4\x5E\x02\x19\x40\xDB\x48\x3E\x16\xFD\x1D\x9C\x09\x67\xA0\xD9\xE1\x04\x0E\x05\x10\x46\x72\x01\x06\x66\x4B\xD3\xAB\xAD\x2A\xC5\xF2\x73\x5F\xBB";
#endif

#ifdef SERVER_SPELLBORN
unsigned char bSwapTable[]		= "\x45\x0B\xE8\x9D\x1D\x1F\x9B\x06\xA6\x01\x71\xCA\xBC\xD9\x82\x16\xD5\x09\x46\x5E\x33\xEE\xBE\x5D\x4F\xDE\x80\xC4\xA1\x56\xD7\xFC\x64\xE6\xC0\x9A\x66\x5F\x97\x5B\x39\xFE\x63\xC9\x14\x99\xFA\xA7\xD0\x58\x95\x20\xAA\x37\x8F\x6D\x47\x69\x1B\x1A\x68\xB9\xD3\x62\x6A\x13\xDF\xEB\xF9\xAB\x3C\xF0\xC1\x1E\x41\x86\x40\x23\xD8\x89\xB0\x7E\xDC\x8E\xAC\x96\xD6\xA3\x05\xA0\x60\xF4\x29\x42\x36\x21\x93\x84\x3A\x2E\xC8\xF2\xFD\x25\x81\x07\x2B\x3D\x34\xAF\x50\x2C\x4C\x31\xAE\x6B\x88\xD4\xE5\xE9\x98\xF1\x59\xB4\x67\x12\xE7\x3F\x91\xEC\x77\x19\x52\x35\x7F\x38\xC3\xB2\x3B\xE0\xFB\xB1\x03\xCC\xC6\xCF\x28\x85\x6C\x8B\xBB\x0A\x2F\xCB\xB3\xD1\x7B\xBF\x24\xAD\x73\xEF\x65\x7D\x55\x5A\xCD\x2D\x4B\x4A\x02\x10\x79\x8A\x92\x54\x7C\x9C\x78\x90\x0D\xA5\xE1\xF7\xF5\xE2\x8D\xC7\x53\xA2\x75\xEA\xBA\xED\x2A\x30\x04\x72\x5C\x43\xC2\xCE\x4D\x44\x83\x94\x6E\xB7\x0E\xE4\x8C\x6F\x0F\xB6\xBD\xB8\x0C\xFF\xC5\xDA\x70\x9E\x32\x17\x49\xA9\x26\x08\xA8\xF3\x3E\x87\xDD\x1C\x11\x57\x7A\xF6\x18\xB5\xDB\x9F\x76\x00\x22\x61\xD2\x74\xF8\x27\xA4\xE3\x15\x48\x51\x4E";
unsigned char bUnSwapTable[]	= "\xF3\x09\xAA\x8E\xC4\x58\x07\x69\xE3\x11\x97\x01\xD8\xB4\xD0\xD4\xAB\xEA\x7D\x41\x2C\xFC\x0F\xDF\xEE\x83\x3B\x3A\xE9\x04\x49\x05\x33\x5F\xF4\x4D\x9E\x67\xE2\xF9\x92\x5C\xC2\x6A\x6F\xA7\x63\x98\xC3\x71\xDE\x14\x6C\x85\x5E\x35\x87\x28\x62\x8A\x46\x6B\xE6\x7F\x4C\x4A\x5D\xC7\xCB\x00\x12\x38\xFD\xE0\xA9\xA8\x70\xCA\xFF\x18\x6E\xFE\x84\xBC\xAF\xA4\x1D\xEB\x31\x7A\xA5\x27\xC6\x17\x13\x25\x5A\xF5\x3F\x2A\x20\xA2\x24\x7C\x3C\x39\x40\x73\x94\x37\xCE\xD3\xDC\x0A\xC5\xA0\xF7\xBE\xF2\x82\xB2\xAC\xEC\x9C\xB0\xA3\x51\x86\x1A\x68\x0E\xCC\x61\x93\x4B\xE7\x74\x4F\xAD\x95\xD2\xBA\x53\x36\xB3\x80\xAE\x60\xCD\x32\x55\x26\x78\x2D\x23\x06\xB1\x03\xDD\xF1\x59\x1C\xBD\x57\xFA\xB5\x08\x2F\xE4\xE1\x34\x45\x54\x9F\x72\x6D\x50\x8D\x89\x9A\x7B\xEF\xD5\xCF\xD7\x3D\xC0\x96\x0C\xD6\x16\x9D\x22\x48\xC8\x88\x1B\xDA\x90\xBB\x64\x2B\x0B\x99\x8F\xA6\xC9\x91\x30\x9B\xF6\x3E\x75\x10\x56\x1E\x4E\x0D\xDB\xF0\x52\xE8\x19\x42\x8B\xB6\xB9\xFB\xD1\x76\x21\x7E\x02\x77\xBF\x43\x81\xC1\x15\xA1\x47\x79\x65\xE5\x5B\xB8\xED\xB7\xF8\x44\x2E\x8C\x1F\x66\x29\xD9";
unsigned char bEncryptionKey[]	= "\x1C\xA5\x2A\x6D\xA3\xB6\x4C\x4B\x78\x1E\x99\x14\x4A\x68\xC0\xCF\xCE\xFF\xD2\x54\x4B\x9E\xEB\x61\x5C\x09\x15\xE9\xF2\xFB\x69\xAF\x98\x5F\x78\x14\xFB\xC2\xE9\x2D\xA9\x09\x63\x19\x19\x5F\xAD\x92\xEC\x72\x13\xC1\x72\xDF\x0C\x57\x70\xEA\x1B\xD9\x20\x73\xF3\x3B\x7A\x26\xDE\xB1\xB2\xF1\x5F\xC2\x02\xBB\x16\x9E\xA9\x53\xE5\xB1\x34\xA6\x51\x78\xFC\x36\x2B\x94\xF0\xC7\x6F\x1D\x94\x5B\x6C\x38\x4A\x61\x25\xEC\xD1\x2A\xF8\x31\x0B\x9C\x7D\x4A\x03\x2A\xB1\x55\x2E\x04\x54\x21\xF1\x8A\x8F\x3F\x64\x07\xDA\x5C\x56\x9C\x1D\xCE\x91\x7A\x15\x6C\x5E\x54\xFA\xA3\x4C\x15\x5F\xC6\x2E\xCE\x59\xA6\x63\xF2\xE3\x63\x5A\xC5\x81\x81\x54\x12\x24\x3E\x6C\x1C\x4E\x23\xD5\xD8\x76\xDA\x64\x59\xAE\x3F\x4E\x8C\x83\xB9\x32\x25\x25\xCB\x5A\xD9\xC8\xE6\x3E\xCE\x49\x82\x49\x50\x15\x6D\xE0\xC5\x47\x62\xA1\xE3\x10\xDD\xE8\x20\x5C\x2E\x98\x6A\xB2\xCC\x18\x19\x5C\xED\x9B\x22\xC9\x53\xA5\x8D\x2F\x69\xCB\x29\x74\x8E\xBA\x7E\x4F\xB1\x7A\x03\xAB\x1E\xF4\x91\x4C\x97\xB2\x18\xB4\xA7\xE7\x91\x48\x33\xAF\x33\xAF\x52\x97\xEA\x7B\x5F\x60\x05\x0B\x4C\x00\x2E\xAF\x38";
#endif

#ifdef SERVER_EVO
unsigned char bSwapTable[]		= "\x45\x0B\xE8\x9D\x1D\x1F\x9B\x06\xA6\x01\x71\xCA\xBC\xD9\x82\x16\xD5\x09\x46\x5E\x33\xEE\xBE\x5D\x4F\xDE\x80\xC4\xA1\x56\xD7\xFC\x64\xE6\xC0\x9A\x66\x5F\x97\x5B\x39\xFE\x63\xC9\x14\x99\xFA\xA7\xD0\x58\x95\x20\xAA\x37\x8F\x6D\x47\x69\x1B\x1A\x68\xB9\xD3\x62\x6A\x13\xDF\xEB\xF9\xAB\x3C\xF0\xC1\x1E\x41\x86\x40\x23\xD8\x89\xB0\x7E\xDC\x8E\xAC\x96\xD6\xA3\x05\xA0\x60\xF4\x29\x42\x36\x21\x93\x84\x3A\x2E\xC8\xF2\xFD\x25\x81\x07\x2B\x3D\x34\xAF\x50\x2C\x4C\x31\xAE\x6B\x88\xD4\xE5\xE9\x98\xF1\x59\xB4\x67\x12\xE7\x3F\x91\xEC\x77\x19\x52\x35\x7F\x38\xC3\xB2\x3B\xE0\xFB\xB1\x03\xCC\xC6\xCF\x28\x85\x6C\x8B\xBB\x0A\x2F\xCB\xB3\xD1\x7B\xBF\x24\xAD\x73\xEF\x65\x7D\x55\x5A\xCD\x2D\x4B\x4A\x02\x10\x79\x8A\x92\x54\x7C\x9C\x78\x90\x0D\xA5\xE1\xF7\xF5\xE2\x8D\xC7\x53\xA2\x75\xEA\xBA\xED\x2A\x30\x04\x72\x5C\x43\xC2\xCE\x4D\x44\x83\x94\x6E\xB7\x0E\xE4\x8C\x6F\x0F\xB6\xBD\xB8\x0C\xFF\xC5\xDA\x70\x9E\x32\x17\x49\xA9\x26\x08\xA8\xF3\x3E\x87\xDD\x1C\x11\x57\x7A\xF6\x18\xB5\xDB\x9F\x76\x00\x22\x61\xD2\x74\xF8\x27\xA4\xE3\x15\x48\x51\x4E";
unsigned char bUnSwapTable[]	= "\xF3\x09\xAA\x8E\xC4\x58\x07\x69\xE3\x11\x97\x01\xD8\xB4\xD0\xD4\xAB\xEA\x7D\x41\x2C\xFC\x0F\xDF\xEE\x83\x3B\x3A\xE9\x04\x49\x05\x33\x5F\xF4\x4D\x9E\x67\xE2\xF9\x92\x5C\xC2\x6A\x6F\xA7\x63\x98\xC3\x71\xDE\x14\x6C\x85\x5E\x35\x87\x28\x62\x8A\x46\x6B\xE6\x7F\x4C\x4A\x5D\xC7\xCB\x00\x12\x38\xFD\xE0\xA9\xA8\x70\xCA\xFF\x18\x6E\xFE\x84\xBC\xAF\xA4\x1D\xEB\x31\x7A\xA5\x27\xC6\x17\x13\x25\x5A\xF5\x3F\x2A\x20\xA2\x24\x7C\x3C\x39\x40\x73\x94\x37\xCE\xD3\xDC\x0A\xC5\xA0\xF7\xBE\xF2\x82\xB2\xAC\xEC\x9C\xB0\xA3\x51\x86\x1A\x68\x0E\xCC\x61\x93\x4B\xE7\x74\x4F\xAD\x95\xD2\xBA\x53\x36\xB3\x80\xAE\x60\xCD\x32\x55\x26\x78\x2D\x23\x06\xB1\x03\xDD\xF1\x59\x1C\xBD\x57\xFA\xB5\x08\x2F\xE4\xE1\x34\x45\x54\x9F\x72\x6D\x50\x8D\x89\x9A\x7B\xEF\xD5\xCF\xD7\x3D\xC0\x96\x0C\xD6\x16\x9D\x22\x48\xC8\x88\x1B\xDA\x90\xBB\x64\x2B\x0B\x99\x8F\xA6\xC9\x91\x30\x9B\xF6\x3E\x75\x10\x56\x1E\x4E\x0D\xDB\xF0\x52\xE8\x19\x42\x8B\xB6\xB9\xFB\xD1\x76\x21\x7E\x02\x77\xBF\x43\x81\xC1\x15\xA1\x47\x79\x65\xE5\x5B\xB8\xED\xB7\xF8\x44\x2E\x8C\x1F\x66\x29\xD9";
unsigned char bEncryptionKey[]	= "\x1C\xA5\x2A\x6D\xA3\xB6\x4C\x4B\x78\x1E\x99\x14\x4A\x68\xC0\xCF\xCE\xFF\xD2\x54\x4B\x9E\xEB\x61\x5C\x09\x15\xE9\xF2\xFB\x69\xAF\x98\x5F\x78\x14\xFB\xC2\xE9\x2D\xA9\x09\x63\x19\x19\x5F\xAD\x92\xEC\x72\x13\xC1\x72\xDF\x0C\x57\x70\xEA\x1B\xD9\x20\x73\xF3\x3B\x7A\x26\xDE\xB1\xB2\xF1\x5F\xC2\x02\xBB\x16\x9E\xA9\x53\xE5\xB1\x34\xA6\x51\x78\xFC\x36\x2B\x94\xF0\xC7\x6F\x1D\x94\x5B\x6C\x38\x4A\x61\x25\xEC\xD1\x2A\xF8\x31\x0B\x9C\x7D\x4A\x03\x2A\xB1\x55\x2E\x04\x54\x21\xF1\x8A\x8F\x3F\x64\x07\xDA\x5C\x56\x9C\x1D\xCE\x91\x7A\x15\x6C\x5E\x54\xFA\xA3\x4C\x15\x5F\xC6\x2E\xCE\x59\xA6\x63\xF2\xE3\x63\x5A\xC5\x81\x81\x54\x12\x24\x3E\x6C\x1C\x4E\x23\xD5\xD8\x76\xDA\x64\x59\xAE\x3F\x4E\x8C\x83\xB9\x32\x25\x25\xCB\x5A\xD9\xC8\xE6\x3E\xCE\x49\x82\x49\x50\x15\x6D\xE0\xC5\x47\x62\xA1\xE3\x10\xDD\xE8\x20\x5C\x2E\x98\x6A\xB2\xCC\x18\x19\x5C\xED\x9B\x22\xC9\x53\xA5\x8D\x2F\x69\xCB\x29\x74\x8E\xBA\x7E\x4F\xB1\x7A\x03\xAB\x1E\xF4\x91\x4C\x97\xB2\x18\xB4\xA7\xE7\x91\x48\x33\xAF\x33\xAF\x52\x97\xEA\x7B\x5F\x60\x05\x0B\x4C\x00\x2E\xAF\x38";
#endif

#ifdef SERVER_ANTARES
unsigned char bSwapTable[]		= "\xCC\xA7\x17\xDD\xF2\x2B\x23\x0C\xD2\x39\x7E\xBE\xEC\x58\x0E\xFD\x15\x33\x1B\x12\xB2\x68\xF4\x91\xC7\xB8\x9E\x3E\x26\x4E\xD7\x69\x61\x52\xA6\xE8\x04\xCD\xBC\x21\x6B\xD1\x40\xD0\x5F\xC2\x7B\x72\xC3\xE5\x45\x88\x6E\x2D\x92\x85\xAA\xDB\x25\x22\xF1\x55\x9A\xA9\xCB\x54\xB7\x10\x50\x86\xF7\x28\x67\xA0\xF0\xC9\xFA\x71\xE7\x03\x4A\xEB\xB5\x16\x8E\x57\x51\x81\x94\xDF\x4D\x65\x93\x9D\x30\x80\x01\x0F\xA2\x76\xF5\xD4\x62\x3A\x75\x05\x1C\x5D\x27\x14\x07\x35\xE9\x2A\x74\xAC\x6A\x1F\xCA\x41\xB0\x02\xA3\x89\x4F\x24\x79\x47\xBB\x96\x90\xD5\xD8\x84\x42\xB1\xDA\xBA\xFF\xE1\x77\x97\x20\xF9\x46\x7C\x7A\x38\x49\xA5\x11\xC6\xEA\x7D\xDC\xC0\x31\x63\xB4\x6D\xA1\x0B\xFB\x9F\x3B\x8B\x2F\x56\x6F\x29\x3D\x5E\xB3\x1E\xC5\x95\x9B\x64\x09\x2C\x78\x36\x34\xF3\x83\x1D\xFC\xAE\x0A\xBD\xEE\x37\x99\xD3\x44\x9C\x87\x06\xA4\x66\x70\xC4\xC8\xE2\xED\x60\x18\x19\x00\xCE\x0D\xEF\x59\xE6\x4C\xA8\x3F\xAB\x2E\x8F\x48\xC1\x6C\xE3\xD9\x5B\xAF\x53\x3C\xFE\xCF\x8D\xAD\x4B\x8A\x1A\xF8\x5A\xB6\x82\x5C\xBF\xB9\xD6\x13\x43\x73\x32\x7F\x08\xE4\xDE\x98\xF6\xE0\x8C";
unsigned char bUnSwapTable[]	= "\xD0\x60\x79\x4F\x24\x69\xC5\x6E\xF9\xB2\xBC\xA1\x07\xD2\x0E\x61\x43\x96\x13\xF4\x6D\x10\x53\x02\xCE\xCF\xEB\x12\x6A\xB9\xAD\x75\x8E\x27\x3B\x06\x7D\x3A\x1C\x6C\x47\xA9\x71\x05\xB3\x35\xDA\xA6\x5E\x9C\xF7\x11\xB6\x6F\xB5\xBF\x93\x09\x67\xA4\xE4\xAA\x1B\xD8\x2A\x77\x86\xF5\xC2\x32\x90\x7F\xDC\x94\x50\xE9\xD6\x5A\x1D\x7C\x44\x56\x21\xE3\x41\x3D\xA7\x55\x0D\xD4\xED\xE1\xF0\x6B\xAB\x2C\xCD\x20\x66\x9D\xB1\x5B\xC7\x48\x15\x1F\x74\x28\xDE\x9F\x34\xA8\xC8\x4D\x2F\xF6\x72\x68\x63\x8C\xB4\x7E\x92\x2E\x91\x99\x0A\xF8\x5F\x57\xEF\xB8\x85\x37\x45\xC4\x33\x7B\xEA\xA5\xFF\xE7\x54\xDB\x82\x17\x36\x5C\x58\xAF\x81\x8D\xFC\xC0\x3E\xB0\xC3\x5D\x1A\xA3\x49\xA0\x62\x7A\xC6\x95\x22\x01\xD7\x3F\x38\xD9\x73\xE8\xBB\xE2\x78\x87\x14\xAC\x9E\x52\xEE\x42\x19\xF2\x89\x80\x26\xBD\x0B\xF1\x9B\xDD\x2D\x30\xC9\xAE\x97\x18\xCA\x4B\x76\x40\x00\x25\xD1\xE6\x2B\x29\x08\xC1\x65\x83\xF3\x1E\x84\xE0\x88\x39\x9A\x03\xFB\x59\xFE\x8B\xCB\xDF\xFA\x31\xD5\x4E\x23\x70\x98\x51\x0C\xCC\xBE\xD3\x4A\x3C\x04\xB7\x16\x64\xFD\x46\xEC\x8F\x4C\xA2\xBA\x0F\xE5\x8A";
unsigned char bEncryptionKey[]	= "\xE1\x7D\x67\x3B\x6A\x0D\x0C\x7A\xD4\xD5\x47\xDB\x4D\x1C\x77\x16\xBB\x37\x90\x85\x4B\xDE\x0B\x51\xFA\xBD\x24\x64\x9D\xB9\x79\x13\x7B\x27\x9E\x08\x1F\x39\x5D\x42\x61\x69\x2D\x86\x4E\x41\x1E\xF8\xF7\xA3\x49\xB5\x26\xFB\x22\x0A\xC0\xA6\x8E\x36\xE4\xC4\xCF\xEC\x60\xD3\x56\xCE\xF4\x23\x6D\x5E\xCB\x83\xD7\x20\x29\x76\x3C\x2E\xED\xD8\x8F\x9F\xCC\xBF\x81\x98\xAC\x03\x6C\x05\xEA\xAF\x92\x96\x45\x99\xAD\xE3\xAE\x6E\x09\xA8\x0F\x1D\x80\xEF\x74\x50\x28\x63\x5C\xF2\x87\x04\xC1\x30\x3A\x2C\x6F\x01\x2F\x59\xFF\x70\xF3\x44\x4A\xA2\xB7\xA0\x02\xAB\x17\x14\x5F\xC5\x11\x9B\xB0\x9A\x46\x58\xBA\x57\x72\xEB\x97\xFC\xC3\x34\xC2\xE8\x71\xA5\x8C\xF5\x73\xDD\x7F\xEE\x54\xFD\x4C\xC6\x18\xDA\x2A\x8D\x78\xB8\x8B\x88\xD1\xA4\x21\xF1\x75\x32\xDC\xD6\xB4\xB2\xE0\xB6\xCD\x15\x94\x93\x48\xA7\x62\x8A\x5B\x7C\xB3\x53\xE9\xDF\xFE\xC9\xE6\x3D\x33\xBC\x12\x52\x0E\x89\xBE\x55\x40\xF9\xB1\xE7\xAA\x65\x3E\x10\x07\x19\x6B\xD0\xC8\x91\xF6\x84\x1A\x3F\x35\xD2\x25\xE2\x68\x5A\xCA\x4F\x38\xF0\x2B\x7E\x31\x9C\x00\x43\xE5\xD9\xA1\x1B\x95\xC7\x66\x82\xA9\x06";
#endif

#ifndef TW
#define bSwapTable2 bSwapTable
#define bUnSwapTable2 bUnSwapTable
#endif

void PosEncrypt(unsigned char* source, int len, unsigned char* keypos)
{
	for(int i=0;i<len;i++)
	{
		unsigned char tmp = source[i];
		
		tmp ^= bEncryptionKey[*keypos];

		if(keypos)
			tmp ^= *keypos;

		if(keypos)
			tmp = (tmp >> (*keypos & 7))|(tmp << (8-(*keypos & 7)));

		source[i] = bSwapTable[/*BitTwist(*/tmp/*)*/];

		(*keypos)++;
	}
}

void PosDecrypt(unsigned char* source, int len, unsigned char* keypos)
{
	for(int i=0;i<len;i++)
	{
		unsigned char tmp = bUnSwapTable[source[i]];

		//tmp = BitUntwist(tmp);

		if(keypos)
			tmp = (tmp << (*keypos & 7))|(tmp >> (8-(*keypos & 7)));

		if(keypos)
			tmp ^= *keypos;

		tmp ^= bEncryptionKey[*keypos];

		source[i] = tmp;

		(*keypos)++;
	}
}

void PosEncryptNet(UCHAR* source, UINT32 len, UCHAR* keypos)
{
#ifdef CRYPTO_S
	return;
#endif
	for(UINT32 i=0;i<len;i++)
	{
		source[i] = bSwapTable2[source[i]];

		source[i] ^= bEncryptionKey[*keypos];

		source[i] = (source[i] >> (*keypos & 7))|(source[i] << (8-(*keypos & 7)));

		(*keypos)++;
	}
}

void PosDecryptNet(UCHAR* source, UINT32 len)
{
#ifdef CRYPTO_S
	return;
#endif
	for(UINT32 i=0;i<len;i++)
	{
		source[i] = bSwapTable2[source[i]^(len&0xFF)];
	}
}